<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Test</title>
</head>

<body>
    <video id="video" width="320" height="240" controls mute>
        <source src="http://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4"
            type="video/mp4">
    </video>
    <script>
        /*
        MediaTrigger v.1.2
        */
        (function (window, document, undefined) {
            function MediaTrigger(params) {
                this.media = params.media;
                this.breakpoints = params.triggers;
                this.currentBreakpoint = 0;
                this.timeInterval = params.precision;
                this.logs = (typeof params.logs == "boolean") ? params.logs : false;
            }

            MediaTrigger.prototype._check = function () {
                if (this.logs) console.log("[MediaTrigger] " + this.media.currentTime);
                if (this.breakpoints[this.currentBreakpoint].triggerTime) {
                    if (this.ctime >= this.breakpoints[this.currentBreakpoint].triggerTime) {
                        this._triggerAction();
                    }
                } else if (this.breakpoints[this.currentBreakpoint].triggerPercent) {
                    if (this.breakpoints[this.currentBreakpoint].triggerPercent > 1) console.warn("[MediaTrigger] triggerPercents must be set between 0 and 1");
                    else if (this.ctime / this.media.duration >= this.breakpoints[this.currentBreakpoint].triggerPercent) {
                        this._triggerAction();
                    }
                };
            }

            MediaTrigger.prototype._triggerAction = function () {
                if (this.logs && typeof this.breakpoints[this.currentBreakpoint].name != undefined) console.warn("[MediaTrigger] " + this.breakpoints[this.currentBreakpoint].name);
                this.breakpoints[this.currentBreakpoint].action();
                this.currentBreakpoint ++;

                if (this.currentBreakpoint > this.breakpoints.length - 1) clearInterval(this.interval);
            }

            MediaTrigger.prototype.start = function () {
                this.currentBreakpoint = 0;              
                var that = this;
                this.interval = setInterval(function () {
                    that.ctime = that.media.currentTime;
                    that._check();
                }, this.timeInterval);
            }

            MediaTrigger.prototype.stop = function () {
                clearInterval(this.interval);
            }

            window.MediaTrigger = MediaTrigger;
        })(window, document);

        var video = document.getElementById('video');
        var mediaTrigger = new MediaTrigger(
            {
                media: video,
                logs: false, // If set to true, the console will log on time the name of each trigger
                precision: 20, // The lower the value, the more precise it will be. You probably shouldn't go under 15 though.
                triggers: [
                    {
                        triggerTime: 1.5, // In seconds
                        name: "Intro", // Optional
                        action: function () {
                            console.log('First trigger');
                        }
                    },
                    {
                        triggerPercent: .01, // Between 0 and 1 
                        action: function () {
                            console.log('Second trigger');
                        }
                    }
                ]
            });

        function startTracking() {
            video.play();
            mediaTrigger.start();
        }

        function stopTtracking() {
            video.pause();
            video.currentTime = 0;
            mediaTrigger.stop();
        }
    </script>
</body>

</html>